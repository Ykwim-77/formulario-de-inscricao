<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Consumindo API</title>
  <link rel="stylesheet" href="candidatos.css">
</head>
<body>
<header>
    <div class="bannerTopo">
      <img src="./imagens/logoGoverno.png" alt="Logo do Governo" class="logoTopo">
      <div class="textosTopo">
        <h1>Governo do Estado do Paran√°</h1>
        <p class="subtitulo">Portal Educacional</p>
      </div>
      <div class="barra-pesquisa">
        <input type="text" placeholder="Pesquisar...">
        <button type="submit">üîç</button>
      </div>
    </div>
  </header>
  <div class="principal">
  <ul id="listaUsuarios"></ul>
  </div>
<div id="modal" class="modal">
  <div class="modal-conteudo">
    <span id="fechar">&times;</span>
    <h2>Editar Usu√°rio</h2>

    <form id="formUsuario">
      <!-- Dados principais -->
      <div class="form-grupo">
        <label>N√∫mero da Inscri√ß√£o:</label>
        <input type="text" id="inputInscricao">
      </div>

      <div class="form-grupo">
        <label> CGM:</label>
        <input type="text" id="inputNome">
      </div>

      <div class="form-grupo">
        <label>Curso:</label>
        <input type="text" id="inputCurso">
      </div>

      <div class="form-grupo">
        <label>Turno:</label>
        <input type="text" id="inputTurno">
      </div>

      <!-- Benefici√°rio -->
      <h3>Benefici√°rio de Programas Federais</h3>
      <div class="form-radio">
        <label><input type="radio" name="beneficiario" value="nao"> N√£o (00)</label>
        <label><input type="radio" name="beneficiario" value="sim"> Sim</label>
        <input type="text" id="inputNIS" placeholder="N√∫mero NIS">
      </div>

      <!-- Origem Escolar -->
      <h3>Origem Escolar</h3>
      <div class="form-radio">
        <label><input type="radio" name="origem" value="85"> Rede P√∫blica / Bolsista integral (85)</label>
        <label><input type="radio" name="origem" value="80"> Parcial P√∫blica (at√© 1 ano Particular) (80)</label>
        <label><input type="radio" name="origem" value="75"> Parcial P√∫blica (2-3 anos Particular) (75)</label>
        <label><input type="radio" name="origem" value="70"> Integral Particular (70)</label>
      </div>

      <!-- M√©dias -->
      <h3>M√©dias</h3>
      <div class="form-grupo">
        <label>M√©dia 9¬∫ ano:</label>
        <input type="number" id="inputMedia9" min="0" max="100">
      </div>

      <!-- Disciplinas -->
      <h3>Disciplinas</h3>
      <div class="form-duas-colunas">
        <div>
          <label>L√≠ngua Portuguesa:</label>
          <input type="number" id="inputPortugues" min="0" max="100">
        </div>
        <div>
          <label>Matem√°tica:</label>
          <input type="number" id="inputMatematica" min="0" max="100">
        </div>
      </div>

      <div class="form-grupo">
        <label>M√©dia Aritm√©tica (0-100):</label>
        <input type="number" id="inputMediaDisciplinas" min="0" max="100">
      </div>

      <!-- Outros -->
      <h3>Avalia√ß√µes</h3>
      <div class="form-duas-colunas">
        <div>
          <label>Pontua√ß√£o Benefici√°rio + Origem:</label>
          <input type="number" id="inputPontuacaoBE" min="0" max="100">
        </div>
        <div>
          <label>Entrevista (0-100):</label>
          <input type="number" id="inputEntrevista" min="0" max="100">
        </div>
      </div>

      <div class="form-grupo">
        <label>Total Geral da Pontua√ß√£o:</label>
        <input type="number" id="inputTotal" min="0" max="100">
      </div>

      <!-- Bot√£o -->
      <button type="submit">Salvar</button>
    </form>
  </div>
</div>
        <footer>
            <div class="footer">
                <div class="footer-logo">
                    <img src="./imagens/logoGoverno.png" alt="Logo do Governo">
                    <h2>Governo do Estado do Paran√°</h2>
                </div>
                <div class="codigos">
                    <h3>Links √∫teis</h3>
                    <ul>
                        <li><a href="#">Sobre</a></li>
                        <li><a href="#">Pol√≠tica de Privacidade</a></li>
                        <li><a href="#">Termos de Uso</a></li>
                        <li><a href="#">Suporte</a></li>
                    </ul>
                </div>
                <div class="contatos">
                    <h3>Contato</h3>
                    <p>Email: rafaelpilonetto59@gmail.com</p>
                    <p>Email: christianmartinkoski@gmail.com</p>
                    <p>Telefone: (46)999890251</p>
                    <p>Telefone: (46)99414639</p>
                </div>
            </div>
            <div class="copyright">
                <p>¬© 2025 Governo do Estado do Paran√° ‚Ä¢ Todos os direitos reservados</p>
            </div>
        </footer>
  <script>
 let usuarioSelecionadoId = null; // Guarda o id do usu√°rio que vai ser editado

// Pega a lista de usu√°rios da API
fetch("http://localhost:3000/candidatos")
  .then(res => res.json())
  .then(dados => {
    const lista = document.getElementById("listaUsuarios");

    dados.forEach(usuario => {
      const item = document.createElement("li");
      item.classList.add("candidato");
      item.innerHTML = `
        <div class="informacoes">
          <div class="info linha-nome">Nome: ${usuario.nome}</div>
          <div class="info linha-celular">Celular: ${usuario.celular_a}</div>
          <div class="info linha-cidade">Cidade: ${usuario.cidade}</div>
          <div class="info linha-curso">Curso: ${usuario.curso}</div>
        </div>
      `;

      // Ao clicar no usu√°rio, abre o modal e salva o id
      item.addEventListener("click", () => {
        usuarioSelecionadoId = usuario.id;
        document.getElementById("modal").style.display = "flex";

        // Preenche os inputs com os dados do usu√°rio
        document.getElementById("inputInscricao").value = usuario.id;
        document.getElementById("inputNome").value = usuario.cpf;
        document.getElementById("inputCurso").value = usuario.curso;
      });

      lista.appendChild(item);
    });
  });

// Captura do form **fora do forEach**
const form = document.getElementById("formUsuario");

form.addEventListener("submit", async (e) => {
  e.preventDefault();

  if (!usuarioSelecionadoId) return alert("Selecione um usu√°rio primeiro!");

  const turno = document.getElementById("inputTurno").value;
  const beneficiario = document.querySelector("input[name='beneficiario']:checked")?.value;
  const nis = document.getElementById("inputNIS").value;
  const origem_escolar = document.querySelector("input[name='origem']:checked")?.value;
  const media_9ano = document.getElementById("inputMedia9").value;
  const portugues_9ano = document.getElementById("inputPortugues").value;
  const matematica_9ano = document.getElementById("inputMatematica").value;
  const media_final_disciplinas = document.getElementById("inputMediaDisciplinas").value;
  const pontuacao_benef_origem = document.getElementById("inputPontuacaoBE").value;
  const entrevista = document.getElementById("inputEntrevista").value;
  const total_geral = document.getElementById("inputTotal").value;

  const usuarioAtualizado = {};

  if (turno) usuarioAtualizado.turno = turno;
  if (beneficiario) usuarioAtualizado.beneficiario = beneficiario;
  if (nis) usuarioAtualizado.nis = nis;
  if (origem_escolar) usuarioAtualizado.origem_escolar = origem_escolar;
  if (media_9ano) usuarioAtualizado.media_9ano = Number(media_9ano);
  if (portugues_9ano) usuarioAtualizado.portugues_9ano = Number(portugues_9ano);
  if (matematica_9ano) usuarioAtualizado.matematica_9ano = Number(matematica_9ano);
  if (media_final_disciplinas) usuarioAtualizado.media_final_disciplinas = Number(media_final_disciplinas);
  if (pontuacao_benef_origem) usuarioAtualizado.pontuacao_benef_origem = Number(pontuacao_benef_origem);
  if (entrevista) usuarioAtualizado.entrevista = Number(entrevista);
  if (total_geral) usuarioAtualizado.total_geral = Number(total_geral);

  try {
    const response = await fetch(`http://localhost:3000/candidatos/${usuarioSelecionadoId}`, {
      method: "PATCH",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify(usuarioAtualizado),
    });

    if (!response.ok) throw new Error("Erro ao atualizar usu√°rio");

    const data = await response.json();
    alert("Usu√°rio atualizado com sucesso!");
    console.log("Resposta da API:", data);
    document.getElementById("modal").style.display = "none";
  } catch (error) {
    console.error("Erro:", error);
    alert("Erro ao atualizar usu√°rio!");
  }
});
const modal = document.getElementById("modal");
modal.addEventListener("click", (e) => {
  if (e.target === modal) {
    modal.style.display = "none";
  }
});
  </script>
</body>
</html>